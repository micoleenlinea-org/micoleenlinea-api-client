{"version":3,"sources":["../../src/config/axios.ts","../../src/config/mock.ts"],"sourcesContent":["import axios, { InternalAxiosRequestConfig } from 'axios';\n\n/**\n * StorageAdapter: Interfaz que abstrae el almacenamiento de tokens.\n * - Web usa localStorage (síncrono)\n * - Mobile usa AsyncStorage (asíncrono)\n */\nexport interface StorageAdapter {\n  getItem: (key: string) => Promise<string | null> | string | null;\n  setItem: (key: string, value: string) => Promise<void> | void;\n  removeItem: (key: string) => Promise<void> | void;\n}\n\n/**\n * Adapter por defecto que usa localStorage (solo funciona en web)\n */\nconst defaultStorageAdapter: StorageAdapter = {\n  getItem: (key: string) => {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      return window.localStorage.getItem(key);\n    }\n    return null;\n  },\n  setItem: (key: string, value: string) => {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      window.localStorage.setItem(key, value);\n    }\n  },\n  removeItem: (key: string) => {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      window.localStorage.removeItem(key);\n    }\n  },\n};\n\n// Storage adapter configurable (se puede cambiar en runtime)\nlet storageAdapter: StorageAdapter = defaultStorageAdapter;\n\n// Callback opcional para manejar logout (401)\nlet onUnauthorizedCallback: (() => void) | null = null;\n\n/**\n * Configura el adaptador de almacenamiento.\n * - Web: no necesita llamar esto (usa localStorage por defecto)\n * - Mobile: debe llamar esto con AsyncStorage\n *\n * @example\n * // En mobile (App.tsx o similar):\n * import AsyncStorage from '@react-native-async-storage/async-storage';\n * import { configureStorage } from '@micoleenlinea/api-client';\n *\n * configureStorage({\n *   getItem: (key) => AsyncStorage.getItem(key),\n *   setItem: (key, value) => AsyncStorage.setItem(key, value),\n *   removeItem: (key) => AsyncStorage.removeItem(key),\n * });\n */\nexport const configureStorage = (adapter: StorageAdapter) => {\n  storageAdapter = adapter;\n};\n\n/**\n * Configura un callback que se ejecuta cuando se recibe un 401 (token inválido/expirado)\n * Útil para redirigir al login o limpiar estado de la app.\n *\n * @example\n * configureOnUnauthorized(() => {\n *   navigation.reset({ index: 0, routes: [{ name: 'Login' }] });\n * });\n */\nexport const configureOnUnauthorized = (callback: () => void) => {\n  onUnauthorizedCallback = callback;\n};\n\n// Función para obtener la URL base dependiendo del entorno\nconst getBaseURL = () => {\n  // Para web (Vite) - usar import.meta.env\n  if (typeof window !== 'undefined') {\n    // @ts-ignore - import.meta.env solo está disponible en tiempo de build de Vite\n    return import.meta.env?.VITE_API_URL || 'http://localhost:8000/api';\n  }\n  // Para mobile (Expo) o Node\n  return process.env.EXPO_PUBLIC_API_URL || 'http://localhost:8000/api';\n};\n\nexport const apiClient = axios.create({\n  baseURL: getBaseURL(),\n  timeout: 10000,\n});\n\n// Función para configurar la base URL desde la app\nexport const configureApiBaseURL = (url: string) => {\n  apiClient.defaults.baseURL = url;\n};\n\n// Token en memoria para acceso rápido (se sincroniza con storage)\nlet cachedToken: string | null = null;\n\n/**\n * Guarda el token de autenticación tanto en memoria como en storage.\n * Usar esta función después del login.\n */\nexport const setAuthToken = async (token: string): Promise<void> => {\n  cachedToken = token;\n  await storageAdapter.setItem('authToken', token);\n};\n\n/**\n * Obtiene el token de autenticación.\n * Primero intenta desde memoria (rápido), luego desde storage.\n */\nexport const getAuthToken = async (): Promise<string | null> => {\n  if (cachedToken) return cachedToken;\n  const token = await storageAdapter.getItem('authToken');\n  if (token) cachedToken = token;\n  return token;\n};\n\n/**\n * Elimina el token de autenticación.\n * Usar esta función durante el logout.\n */\nexport const clearAuthToken = async (): Promise<void> => {\n  cachedToken = null;\n  await storageAdapter.removeItem('authToken');\n};\n\n// Interceptor para agregar el token de autenticación automáticamente\napiClient.interceptors.request.use(\n  async (config: InternalAxiosRequestConfig) => {\n    // Obtener token (primero de cache, luego de storage)\n    const token = await getAuthToken();\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Interceptor para manejar respuestas de error (ej: token expirado)\napiClient.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    // Si el token es inválido o expirado (401), limpiar token y notificar\n    if (error.response?.status === 401) {\n      await clearAuthToken();\n      // Ejecutar callback de logout si está configurado\n      if (onUnauthorizedCallback) {\n        onUnauthorizedCallback();\n      }\n    }\n    // Transformar el error para que coincida con ApiError\n    // Extraemos response.data para que los hooks reciban el tipo correcto\n    const apiError = error.response?.data || { message: error.message || 'Error de conexión' };\n    return Promise.reject(apiError);\n  }\n);\n","/**\n * Configuración centralizada para el modo mock\n * \n * MOCK_MODE = false: usa el API real (QA, producción)\n * MOCK_MODE = true: usa datos simulados (solo para desarrollo local si es necesario)\n */\nexport const MOCK_MODE = false;\n\n"],"mappings":";AAAA,OAAO,WAA2C;AAgBlD,IAAM,wBAAwC;AAAA,EAC5C,SAAS,CAAC,QAAgB;AACxB,QAAI,OAAO,WAAW,eAAe,OAAO,cAAc;AACxD,aAAO,OAAO,aAAa,QAAQ,GAAG;AAAA,IACxC;AACA,WAAO;AAAA,EACT;AAAA,EACA,SAAS,CAAC,KAAa,UAAkB;AACvC,QAAI,OAAO,WAAW,eAAe,OAAO,cAAc;AACxD,aAAO,aAAa,QAAQ,KAAK,KAAK;AAAA,IACxC;AAAA,EACF;AAAA,EACA,YAAY,CAAC,QAAgB;AAC3B,QAAI,OAAO,WAAW,eAAe,OAAO,cAAc;AACxD,aAAO,aAAa,WAAW,GAAG;AAAA,IACpC;AAAA,EACF;AACF;AAGA,IAAI,iBAAiC;AAGrC,IAAI,yBAA8C;AAkB3C,IAAM,mBAAmB,CAAC,YAA4B;AAC3D,mBAAiB;AACnB;AAWO,IAAM,0BAA0B,CAAC,aAAyB;AAC/D,2BAAyB;AAC3B;AAGA,IAAM,aAAa,MAAM;AAEvB,MAAI,OAAO,WAAW,aAAa;AAEjC,WAAO,YAAY,KAAK,gBAAgB;AAAA,EAC1C;AAEA,SAAO,QAAQ,IAAI,uBAAuB;AAC5C;AAEO,IAAM,YAAY,MAAM,OAAO;AAAA,EACpC,SAAS,WAAW;AAAA,EACpB,SAAS;AACX,CAAC;AAGM,IAAM,sBAAsB,CAAC,QAAgB;AAClD,YAAU,SAAS,UAAU;AAC/B;AAGA,IAAI,cAA6B;AAM1B,IAAM,eAAe,OAAO,UAAiC;AAClE,gBAAc;AACd,QAAM,eAAe,QAAQ,aAAa,KAAK;AACjD;AAMO,IAAM,eAAe,YAAoC;AAC9D,MAAI,YAAa,QAAO;AACxB,QAAM,QAAQ,MAAM,eAAe,QAAQ,WAAW;AACtD,MAAI,MAAO,eAAc;AACzB,SAAO;AACT;AAMO,IAAM,iBAAiB,YAA2B;AACvD,gBAAc;AACd,QAAM,eAAe,WAAW,WAAW;AAC7C;AAGA,UAAU,aAAa,QAAQ;AAAA,EAC7B,OAAO,WAAuC;AAE5C,UAAM,QAAQ,MAAM,aAAa;AACjC,QAAI,OAAO;AACT,aAAO,QAAQ,gBAAgB,UAAU,KAAK;AAAA,IAChD;AACA,WAAO;AAAA,EACT;AAAA,EACA,CAAC,UAAU;AACT,WAAO,QAAQ,OAAO,KAAK;AAAA,EAC7B;AACF;AAGA,UAAU,aAAa,SAAS;AAAA,EAC9B,CAAC,aAAa;AAAA,EACd,OAAO,UAAU;AAEf,QAAI,MAAM,UAAU,WAAW,KAAK;AAClC,YAAM,eAAe;AAErB,UAAI,wBAAwB;AAC1B,+BAAuB;AAAA,MACzB;AAAA,IACF;AAGA,UAAM,WAAW,MAAM,UAAU,QAAQ,EAAE,SAAS,MAAM,WAAW,uBAAoB;AACzF,WAAO,QAAQ,OAAO,QAAQ;AAAA,EAChC;AACF;;;ACzJO,IAAM,YAAY;","names":[]}